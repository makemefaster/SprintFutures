<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Board</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; margin:0; background:#f0f2f5; }
        .head { background:#002366; color:white; padding:15px; text-align:center; }
        .tabs { display:flex; background:#333; }
        .tab { flex:1; padding:15px; color:#aaa; text-align:center; cursor:pointer; }
        .tab.active { color:white; background:#444; border-bottom:3px solid #E30613; }
        .cont { padding:15px; display:none; }
        .cont.active { display:block; }
        .match { background:white; margin-bottom:10px; padding:10px; border-radius:5px; box-shadow:0 2px 2px #ddd; }
        .row { display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px solid #eee; }
        .tag { padding:2px 5px; border-radius:3px; font-size:0.8em; font-weight:bold; }
        .win { background:#d4edda; color:green; }
    </style>
</head>
<body>
    <div class="head">
        <h2 style="margin:0;">Live Results</h2>
        <div id="eventIdDisplay" style="font-size:0.8em; opacity:0.8;"></div>
    </div>
    <div class="tabs">
        <div class="tab active" onclick="setTab('sprint')">Sprint</div>
        <div class="tab" onclick="setTab('keirin')">Keirin</div>
    </div>

    <div id="sprintView" class="cont active">Loading Sprint...</div>
    <div id="keirinView" class="cont">Loading Keirin...</div>

<script>
    const firebaseConfig = { // Your web app's Firebase configuration

// For Firebase JS SDK v7.20.0 and later, measurementId is optional

const firebaseConfig = {

  apiKey: "AIzaSyAkTwI7TbJwXPbVQ2OrKjAAIaWLvyfuudc",

  authDomain: "sprintfutures.firebaseapp.com",

  projectId: "sprintfutures",

  storageBucket: "sprintfutures.firebasestorage.app",

  messagingSenderId: "535060943616",

  appId: "1:535060943616:web:d15fc5225538eaeb3459e5",

  measurementId: "G-9XFQV3PLEV/ };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const params = new URLSearchParams(window.location.search);
    const eventID = params.get('event');
    if(eventID) document.getElementById('eventIdDisplay').innerText = "Event: " + eventID;

    if(eventID) {
        db.ref(`events/${eventID}/sprint`).on('value', snap => render('sprint', snap.val()));
        db.ref(`events/${eventID}/keirin`).on('value', snap => render('keirin', snap.val()));
    } else {
        document.body.innerHTML = "<h3 style='text-align:center; margin-top:50px;'>No Event ID Specified</h3>";
    }

    function render(type, data) {
        const div = document.getElementById(type+'View');
        if(!data || !data.heats) { div.innerHTML = "No data yet."; return; }
        
        let html = "";
        // If finished, show rankings
        if(data.isFinished) {
            html += "<h3>Final Standings</h3><table>";
            // (Use same ranking logic as admin app to sort)
            // For simplicity in this view, I'll list "Event Finished - Check Admin for official results"
            html += "<p>Event Completed. See official board.</p>"; 
        }

        // Show Heats
        data.heats.forEach(h => {
            let complete = h.res && h.res.length > 0;
            html += `<div class="match">
                <div style="font-weight:bold; border-bottom:1px solid #eee; padding-bottom:5px;">${h.name} ${complete?'(Done)':''}</div>`;
            h.riders.forEach(r => {
                let idx = h.res ? h.res.indexOf(r.id) : -1;
                let status = idx===0 ? '<span class="tag win">1st</span>' : (idx>-1 ? idx+1 : '');
                html += `<div class="row"><div>#${r.bib||''} ${r.name}</div><div>${status}</div></div>`;
            });
            html += "</div>";
        });
        div.innerHTML = html;
    }

    window.setTab = (t) => {
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        document.querySelectorAll('.cont').forEach(x=>x.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById(t+'View').classList.add('active');
    }
</script>
</body>
</html>
